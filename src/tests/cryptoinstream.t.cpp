#include "gtest/gtest.h"

#include "types/datarefinstream.h"
#include "crypto/cryptoinstream.h"

TEST(CryptoInStream, Simple)
{
    const uint8_t AesFile[] =
    "\x41\x45\x53\x02\x00\x00\x19\x43\x52\x45\x41\x54\x45\x44\x5f\x42"
    "\x59\x00\x70\x79\x41\x65\x73\x43\x72\x79\x70\x74\x20\x30\x2e\x33"
    "\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\x00\x00\x00\x00\xb3\x1f\x6c\xe9\x00\xa9\x36\x9f\x12\xf5\x75\x0e"
    "\x37\xef\x17\xaa\x5a\x29\xfe\xb5\x7a\x1b\x92\xea\x08\xae\x92\x35"
    "\xa2\xc7\x8d\x55\x13\x6a\x5d\x7f\xcc\x28\x74\x3f\x8c\x05\x0e\x45"
    "\xd4\xc7\x94\x29\x65\xc7\x29\xc7\xc5\x20\xef\x51\xe7\x64\x57\x59"
    "\x23\x21\xc6\x7c\xdf\x2a\xb7\x08\xf5\x1e\xef\xa9\x49\x55\xc7\xff"
    "\x4d\xb0\x98\x0d\x53\xf8\x69\xd6\x71\x07\x25\xe7\xd2\xec\x02\x4e"
    "\x80\x40\xd8\x86\x4d\xf4\xf7\xfc\xde\xc0\x15\xac\xea\x56\xfc\x82"
    "\x1f\x85\x3e\x32\x0f\x0b\x44\xd4\x35\xa7\x87\xd3\x7b\xda\x06\xda"
    "\x5b\xa9\x3e\x9c\xd1\x9c\xfc\x35\x3d\xbb\x89\xaa\xa7\xbc\x0d\x3a"
    "\x41\x75\x43\xbd\xfd";
    
    DataRefInStream is(DataRef(AesFile, AesFile + sizeof(AesFile)));
    CryptoInStream cis(is, "test");

    ASSERT_EQ(cis.error(), CryptoInStream::Error::kNone);
}
